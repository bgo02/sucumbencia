<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora de Sucumbência Previdenciária</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #fafafa;
        color: #222;
        max-width: 900px;
    }
    h1 { text-align: center; margin-bottom: 28px; }
    textarea, input, select {
        width: 100%; padding: 10px; margin-top: 6px; margin-bottom: 16px;
        border: 1px solid #bbb; border-radius: 4px; font-size: 15px;
    }
    button {
        background: #333; color: #fff; border: none; padding: 12px 18px;
        font-size: 16px; cursor: pointer; border-radius: 5px;
    }
    button:hover { background: #111; }
    .result-box {
        background: #fff; padding: 20px; border-radius: 8px;
        border: 1px solid #ccc; margin-top: 30px; white-space: pre-wrap;
    }
</style>
</head>

<body>
<h1>Calculadora de Sucumbência Previdenciária</h1>

<label><b>A parte autora possui AJG?</b></label>
<select id="ajg">
    <option value="sim" selected>Sim</option>
    <option value="nao">Não</option>
</select>

<label><b>Há pedido de danos morais?</b></label>
<select id="temDanos" onchange="toggleDanos()">
    <option value="sim">Sim</option>
    <option value="nao">Não</option>
</select>

<div id="camposDanos">
    <label><b>Valor total da causa (R$)</b></label>
    <input id="valorCausa" type="number" placeholder="Ex.: 50000">

    <label><b>Valor pedido a título de danos morais (R$)</b></label>
    <input id="danosMorais" type="number" placeholder="Ex.: 10000">
</div>

<label><b>Períodos discutidos (cole qualquer formato)</b></label>
<textarea id="periodosBrutos" rows="7" placeholder="Cole aqui os períodos discutidos. O sistema limpará automaticamente."></textarea>

<label><b>Períodos reconhecidos (cole qualquer formato)</b></label>
<textarea id="periodosReconhecidos" rows="7" placeholder="Cole os períodos reconhecidos."></textarea>

<button onclick="calcular()">Calcular Sucumbência</button>

<div id="resultado" class="result-box"></div>

<script>
// --------------------------------------------------------------
// EXIBIÇÃO DINÂMICA DOS CAMPOS DE DANOS MORAIS
// --------------------------------------------------------------
function toggleDanos() {
    const tem = document.getElementById("temDanos").value;
    document.getElementById("camposDanos").style.display = tem === "sim" ? "block" : "none";
}
toggleDanos();

// --------------------------------------------------------------
// PARSER DE PERÍODOS
// --------------------------------------------------------------
function extrairDatas(texto) {
    const regex = /(\d{1,2}\/\d{1,2}\/\d{4})\s*(?:a|-|–|—|ao)\s*(\d{1,2}\/\d{1,2}\/\d{4})/gi;
    let match, arr = [];
    while ((match = regex.exec(texto)) !== null) {
        arr.push({inicio: match[1], fim: match[2]});
    }
    return arr;
}

function somarDias(periodos) {
    let total = 0;
    for (const p of periodos) {
        const i = new Date(p.inicio.split("/").reverse().join("-"));
        const f = new Date(p.fim.split("/").reverse().join("-"));
        if (!isNaN(i) && !isNaN(f) && f >= i)
            total += Math.floor((f - i)/(1000*60*60*24)) + 1;
    }
    return total;
}

// danos morais reconhecidos proporcionalmente aos materiais
function danosMoraisReconhecidos(dm, proporcaoMateriais) {
    return dm * proporcaoMateriais;
}

// --------------------------------------------------------------
// CÁLCULO PRINCIPAL
// --------------------------------------------------------------
function calcular() {

    const honorariosBase = 10; // fixo conforme solicitado
    const ajg = document.getElementById("ajg").value;
    const temDanos = document.getElementById("temDanos").value;

    const todosPeriodos     = extrairDatas(document.getElementById("periodosBrutos").value);
    const periodosReconhec  = extrairDatas(document.getElementById("periodosReconhecidos").value);

    const totalDias = somarDias(todosPeriodos);
    const diasRec   = somarDias(periodosReconhec);

    const proporcaoMateriais = totalDias > 0 ? diasRec / totalDias : 0;

    let ganhoAutora = proporcaoMateriais; // default quando não há danos morais

    let valorCausa = 0, danosMorais = 0, valorMateriais = 0;

    if (temDanos === "sim") {
        valorCausa = Number(document.getElementById("valorCausa").value);
        danosMorais = Number(document.getElementById("danosMorais").value);
        valorMateriais = valorCausa - danosMorais;

        ganhoAutora = (
            (proporcaoMateriais * valorMateriais) +
            danosMoraisReconhecidos(danosMorais, proporcaoMateriais)
        ) / valorCausa;
    }

    // ----------------------------------------------------------
    // SUCUMBÊNCIA MÍNIMA (<10%)
    // ----------------------------------------------------------
    let textoSuc = "";
    let honorAut  = 0;
    let honorINSS = 0;

    if (ganhoAutora < 0.10) {
        textoSuc = 
            "A parte autora decaiu de mais de 90% do pedido, configurando sucumbência mínima. " +
            "Assim, somente o INSS arcará integralmente com a verba honorária.";
        honorINSS = honorariosBase;
    }
    else if (ganhoAutora > 0.90) {
        textoSuc = 
            "O INSS decaiu de mais de 90% do pedido, caracterizando sucumbência mínima. " +
            "Portanto, apenas a parte autora suportará integralmente a verba honorária.";
        honorAut = honorariosBase;
    }
    else {
        textoSuc = 
            "Os pedidos foram acolhidos e rejeitados de forma significativa por ambas as partes. " +
            "A distribuição dos ônus sucumbenciais deve ser proporcional ao decaimento de cada uma.";
        honorAut  = (1 - ganhoAutora) * honorariosBase;
        honorINSS = ganhoAutora * honorariosBase;
    }

    // arredondamentos adequados
    honorAut  = Math.round(honorAut * 100)/100;
    honorINSS = Math.round(honorINSS * 100)/100;

    // ----------------------------------------------------------
    // AJG
    // ----------------------------------------------------------
    let textoAJG = "";
    if (ajg === "sim") {
        textoAJG =
            "A parte autora é beneficiária da gratuidade da justiça. " +
            "Sua responsabilidade pela verba honorária permanece exigível, sem suspensão, " +
            "e o INSS deverá ressarcir-lhe as custas eventualmente adiantadas, na proporção correspondente.";
    }

    // ----------------------------------------------------------
    // RESULTADO FINAL
    // ----------------------------------------------------------
    let r = "Resultado do Cálculo da Sucumbência\n\n";
    r += `Proporção total reconhecida em favor da parte autora: ${(ganhoAutora*100).toFixed(2)}%\n\n`;
    r += textoSuc + "\n\n";

    if (honorAut > 0)
        r += `Honorários devidos pela parte autora: ${honorAut}% do valor da causa.\n`;
    if (honorINSS > 0)
        r += `Honorários devidos pelo INSS: ${honorINSS}% do valor da causa.\n`;

    if (ajg === "sim") r += "\n" + textoAJG;

    document.getElementById("resultado").innerText = r;
}
</script>

</body>
</html>
