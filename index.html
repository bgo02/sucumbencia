<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Calculadora de Sucumbência Previdenciária</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #fafafa;
        color: #222;
        max-width: 900px;
    }
    h1 { text-align: center; font-size: 26px; margin-bottom: 20px; }
    textarea, input, select {
        width: 100%; padding: 10px; margin-top: 6px; margin-bottom: 16px;
        border: 1px solid #bbb; border-radius: 4px; font-size: 15px;
    }
    button {
        background: #333; color: #fff; border: none; padding: 12px 18px;
        font-size: 16px; cursor: pointer; border-radius: 5px;
    }
    button:hover { background: #111; }
    .result-box {
        background: #fff; padding: 20px; border-radius: 8px;
        border: 1px solid #ccc; margin-top: 30px; white-space: pre-wrap;
    }
</style>
</head>

<body>
<h1>Calculadora de Sucumbência Previdenciária</h1>

<label><b>1) Valor total da causa (R$)</b></label>
<input id="valorCausa" type="number" placeholder="Exemplo: 50000">

<label><b>2) Valor pedido a título de danos morais (R$)</b></label>
<input id="danosMorais" type="number" placeholder="Exemplo: 10000">

<label><b>3) Períodos discutidos (cole qualquer coisa: tabelas, listas, frases etc.)</b></label>
<textarea id="periodosBrutos" rows="7" placeholder="Cole aqui os períodos, em qualquer formato. O sistema limpará automaticamente."></textarea>

<label><b>4) Períodos reconhecidos (cole qualquer formato)</b></label>
<textarea id="periodosReconhecidos" rows="7" placeholder="Cole apenas os períodos reconhecidos, em qualquer formato."></textarea>

<label><b>5) A parte autora possui AJG?</b></label>
<select id="ajg">
    <option value="nao">Não</option>
    <option value="sim">Sim</option>
</select>

<label><b>6) Percentual-base dos honorários (ex.: 10)</b></label>
<input id="percentualHonorarios" type="number" placeholder="10">

<button onclick="calcular()">Calcular Sucumbência</button>

<div id="resultado" class="result-box"></div>

<script>
// --------------------------------------------------------------
// FUNÇÕES DE LIMPEZA E EXTRAÇÃO DE PERÍODOS
// --------------------------------------------------------------
function extrairDatas(texto) {
    // captura datas dd/mm/yyyy
    const regex = /(\d{1,2}\/\d{1,2}\/\d{4})\s*(?:a|-|–|—|ao)\s*(\d{1,2}\/\d{1,2}\/\d{4})/gi;
    let match;
    const periodos = [];
    while ((match = regex.exec(texto)) !== null) {
        periodos.push({ inicio: match[1], fim: match[2] });
    }
    return periodos;
}

function somarDias(periodos) {
    let total = 0;
    for (const p of periodos) {
        const i = new Date(p.inicio.split("/").reverse().join("-"));
        const f = new Date(p.fim.split("/").reverse().join("-"));
        if (!isNaN(i) && !isNaN(f) && f >= i) {
            const dias = (f - i) / (1000 * 60 * 60 * 24) + 1;
            total += dias;
        }
    }
    return total;
}

// --------------------------------------------------------------
// CÁLCULO PRINCIPAL
// --------------------------------------------------------------
function calcular() {
    const valorCausa   = Number(document.getElementById("valorCausa").value);
    const danosMorais  = Number(document.getElementById("danosMorais").value);
    const ajg          = document.getElementById("ajg").value;
    const basePercent  = Number(document.getElementById("percentualHonorarios").value);

    const todosPeriodos = extrairDatas(document.getElementById("periodosBrutos").value);
    const reconhecidos  = extrairDatas(document.getElementById("periodosReconhecidos").value);

    const totalDias = somarDias(todosPeriodos);
    const diasReconhecidos = somarDias(reconhecidos);

    // proporção dos pedidos materiais (períodos)
    const proporcaoMateriais = totalDias > 0 ? diasReconhecidos / totalDias : 0;

    // cálculo da proporção global da procedência (materiais + danos morais)
    const valorMateriais = valorCausa - danosMorais;

    let ganhoAutora = 0;
    if (valorMateriais > 0) {
        ganhoAutora =
            (proporcaoMateriais * valorMateriais + danosMoraisReconhecidos(danosMorais, proporcaoMateriais))
            / valorCausa;
    }

    // sucumbência mínima (<10%)
    let textoSucumbencia = "";
    let honorariosAutora = 0;
    let honorariosINSS = 0;

    if (ganhoAutora < 0.10) {
        textoSucumbencia =
            "A sucumbência da parte autora é inferior a 10% do proveito econômico pretendido. Trata-se, portanto, de sucumbência mínima. " +
            "Assim, apenas o INSS suportará integralmente os ônus sucumbenciais.";
        honorariosINSS = basePercent;
        honorariosAutora = 0;
    } else if (ganhoAutora > 0.90) {
        textoSucumbencia =
            "A sucumbência do INSS é inferior a 10% do total controvertido, configurando sucumbência mínima. " +
            "Assim, somente a parte autora suportará os ônus sucumbenciais.";
        honorariosAutora = basePercent;
        honorariosINSS = 0;
    } else {
        const percAutora = (1 - ganhoAutora) * basePercent;
        const percINSS   = ganhoAutora * basePercent;
        honorariosAutora = percAutora;
        honorariosINSS   = percINSS;
        textoSucumbencia =
            "Ambas as partes decaíram de forma significativa de seus pedidos e defesas. A distribuição dos ônus sucumbenciais deve ocorrer de forma proporcional a cada decaimento.";
    }

    // AJG
    let textoAJG = "";
    if (ajg === "sim") {
        textoAJG =
            "A parte autora é beneficiária da gratuidade da justiça, razão pela qual a condenação referente à sua parcela de sucumbência não é suspensa, mas será exigível normalmente. " +
            "O INSS deverá ressarcir a parte autora pelas custas que esta houver adiantado, na proporção correspondente.";
    }

    // Resultado final
    let resultado = "";
    resultado += "Resultado do Cálculo da Sucumbência\n\n";
    resultado += `Proporção total reconhecida: ${(ganhoAutora*100).toFixed(2)}%\n\n`;
    resultado += textoSucumbencia + "\n\n";

    if (honorariosAutora > 0)
        resultado += `Honorários devidos pela parte autora: ${honorariosAutora.toFixed(2)}% do valor da causa.\n`;
    if (honorariosINSS > 0)
        resultado += `Honorários devidos pelo INSS: ${honorariosINSS.toFixed(2)}% do valor da causa.\n`;

    if (ajg === "sim") resultado += "\n" + textoAJG;

    document.getElementById("resultado").innerText = resultado;
}

// danos morais reconhecidos proporcionalmente aos materiais
function danosMoraisReconhecidos(dm, proporcaoMateriais) {
    return dm * proporcaoMateriais;
}
</script>

</body>
</html>
